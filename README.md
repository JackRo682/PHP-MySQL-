# PHP MySQL Receipt MVP

내부 전산용 인수증(주문서) 웹앱 MVP 입니다. PHP 8.2 + MySQL 8.0 환경에서 프레임워크 없이 동작합니다.

## 주요 기능
- 세션 로그인(admin/staff), CSRF 토큰, XSS 대응(escape) 적용
- 인수증 생성 화면: 최대 10개의 템플릿 버튼, 부자재 체크박스, 복수(N) 생성 지원
- 인수증 번호: 날짜 기반 `R-YYYYMMDD-0001` 증가, 동시성 안전(SELECT ... FOR UPDATE)
- 템플릿 관리(관리자): 활성 최대 10개, CRUD, AJAX 적용
- 인수증 리스트: 체크박스 다중 선택 후 상태 일괄 변경 + 로그 기록

## 설치
1. PHP 8.2, MySQL 8.0이 필요합니다.
2. 데이터베이스 초기화:
   ```sh
   mysql -u root -p < sql/001_schema.sql
   mysql -u root -p < sql/002_seed.sql
   ```
3. 웹 서버 실행 (개발용 PHP 내장 서버):
   ```sh
   php -S 0.0.0.0:8000 -t public
   ```
4. 브라우저에서 `http://localhost:8000/login` 접속

## 기본 계정
- 관리자: `admin / admin1234`
- 로그인 후 비밀번호를 즉시 변경하세요.

## 사용법 요약
- **인수증 생성**: `/receipts/create` → 템플릿 버튼 클릭으로 값 자동 채움 → 생성 개수 N(1~50) 지정 후 저장.
- **복수 생성 이동**: N>1 저장 시 리스트가 batch_group_id로 필터된 상태로 표시됩니다.
- **상태 일괄 변경**: 리스트에서 항목 선택 → 버튼(신규도착완료/동일배송도착완료) → 로그 자동 기록.
- **템플릿 관리**: 관리자 메뉴에서 생성/수정/삭제. 활성 템플릿 10개 제한.

## 동작 확인 시나리오
- 템플릿 2개 생성 후 생성 화면에서 각각 버튼 클릭 → 폼이 해당 값으로 채워지는지 확인
- 생성 화면에서 N=10 입력 후 저장 → 리스트에서 연속된 `R-YYYYMMDD-XXXX` 10개 생성 여부 확인
- 동시성 개념 테스트: 두 브라우저에서 동시에 N=5 생성 → receipt_no 중복 없는지 확인
- 리스트에서 3건 선택 후 "신규도착완료" 클릭 → 3건만 상태 변경, 로그 테이블에서 변경 기록 확인

## 주의사항
- 외부 라이브러리 없이 동작합니다. PHP 확장: `pdo_mysql` 필요
- CSRF 토큰이 모든 POST 폼에 포함되어야 하므로 자체 폼을 추가할 때 `csrf_token()` 필드를 넣으세요.
- DB 접속 정보는 `app/config.php`에서 수정합니다.
